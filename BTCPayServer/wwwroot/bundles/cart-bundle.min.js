function Cart(){this.items=0;this.totalAmount=0;this.content=[];this.loadLocalStorage();this.buildUI();this.$list=$("#js-cart-list");this.$items=$("#js-cart-items");this.$total=$(".js-cart-total");this.$summaryProducts=$(".js-cart-summary-products");this.$summaryDiscount=$(".js-cart-summary-discount");this.$summaryTotal=$(".js-cart-summary-total");this.$summaryTip=$(".js-cart-summary-tip");this.$destroy=$(".js-cart-destroy");this.$confirm=$("#js-cart-confirm");this.listItems();this.bindEmptyCart();this.updateItemsCount();this.updateAmount();this.updatePosData()}function removeAccents(n){for(var r="AAAAAAaaaaaaOOOOOOOooooooEEEEeeeeeCCccDDdIIIIiiiiLlUUUUuuuuNNnnSsTtYyyZz ",u="",i=-1,t=0;t<n.length;t++)i="ÀÁÂÃÄÅàáâãäåÒÓÔÕÕÖØòóôõöøÈÉÊËèéêëðÇČçčÐĎďÌÍÎÏìíîïĽľÙÚÛÜùúûüÑŇñňŠšŤťŸÿýŽž  ́".indexOf(n[t]),u+=i!=-1?typeof r[i]!="undefined"?r[i]:"":typeof n[t]!="undefined"?n[t]:"";return u}Cart.prototype.setCustomAmount=function(n){return srvModel.showCustomAmount?(this.customAmount=this.toNumber(n),this.customAmount>0?localStorage.setItem(this.getStorageKey("cartCustomAmount"),this.customAmount):localStorage.removeItem(this.getStorageKey("cartCustomAmount")),this.customAmount):0};Cart.prototype.getCustomAmount=function(){return srvModel.showCustomAmount?this.toCents(this.customAmount):0};Cart.prototype.setTip=function(n){return srvModel.enableTips?(this.tip=this.toNumber(n),this.tip>0?localStorage.setItem(this.getStorageKey("cartTip"),this.tip):localStorage.removeItem(this.getStorageKey("cartTip")),this.tip):0};Cart.prototype.getTip=function(){return srvModel.enableTips?this.toCents(this.tip):0};Cart.prototype.setDiscount=function(n){return srvModel.showDiscount?(this.discount=this.toNumber(n),this.discount>0?localStorage.setItem(this.getStorageKey("cartDiscount"),this.discount):localStorage.removeItem(this.getStorageKey("cartDiscount")),this.discount):0};Cart.prototype.getDiscount=function(){return srvModel.showDiscount?this.toCents(this.discount):0};Cart.prototype.getDiscountAmount=function(n){return srvModel.showDiscount?this.percentage(n,this.getDiscount()):0};Cart.prototype.getTotalProducts=function(){var t=0;for(var n in this.content)if(this.content.hasOwnProperty(n)&&typeof this.content[n]!="undefined"&&!this.content[n].disabled){const i=this.toCents(this.content[n].price.value||0);t+=this.content[n].count*i}return t+=this.getCustomAmount()};Cart.prototype.getTotal=function(n){return this.totalAmount=this.getTotalProducts(),this.getDiscount()>0&&(this.totalAmount-=this.getDiscountAmount(this.totalAmount)),n&&(this.totalAmount+=this.getTip()),this.fromCents(this.totalAmount)};Cart.prototype.addItem=function(n){var t=n.id,i=this.content.filter(function(n){return n.id===t});i.length||(this.content.push({id:t,title:n.title,price:n.price,count:0,image:n.image,inventory:n.inventory}),this.emptyCartToggle());this.incrementItem(t)};Cart.prototype.incrementItem=function(n){var u=this.items,i,r,t;for(this.items=0,i=!0,r=0;r<this.content.length;r++){if(t=this.content[r],t.id===n){if(t.inventory!=null&&t.inventory<=t.count){i=!1;continue}t.count++;delete t.disabled}this.items+=t.count}return i||(this.items=u),this.updateAll(),i};Cart.prototype.disableItem=function(n){var t=this;this.content.filter(function(i){i.id===n&&(i.disabled=!0,t.items-=i.count)});this.updateAll()};Cart.prototype.enableItem=function(n){var t=this;this.content.filter(function(i){i.id===n&&(delete i.disabled,t.items+=i.count)});this.updateAll()};Cart.prototype.decrementItem=function(n){var t=this;this.items=0;this.content.filter(function(i,r,u){i.id===n&&(i.count--,delete i.disabled,i.count<=0&&t.removeItem(n,r,u));t.items+=i.count});this.updateAll()};Cart.prototype.removeItemAll=function(n){var t=this;this.items=0;typeof n!="undefined"?this.content.filter(function(i,r,u){if(i.id===n){t.removeItem(n,r,u);for(var f=0;f<i.count;f++)t.items--}t.items+=i.count}):(this.$list.find("tbody").empty(),this.content=[]);this.emptyCartToggle();this.updateAll()};Cart.prototype.removeItem=function(n,t,i){i.splice(t,1);this.$list.find("tr").eq(t+1).remove()};Cart.prototype.updateAll=function(){this.saveLocalStorage();this.updateItemsCount();this.updateDiscount();this.updateSummaryProducts();this.updateSummaryTotal();this.updateTotal();this.updateAmount();this.updatePosData()};Cart.prototype.updateItemsCount=function(){this.$items.text(this.items)};Cart.prototype.updateTotal=function(){this.$total.text(this.formatCurrency(this.getTotal()))};Cart.prototype.updateSummaryTotal=function(){this.$summaryTotal.text(this.formatCurrency(this.getTotal(!0)))};Cart.prototype.updateSummaryProducts=function(){this.$summaryProducts.text(this.formatCurrency(this.fromCents(this.getTotalProducts())))};Cart.prototype.updateDiscount=function(n){var t=0;typeof n!="undefined"?t=n:(t=this.percentage(this.getTotalProducts(),this.getDiscount()),t=this.fromCents(t));this.$summaryDiscount.text((t>0?"-":"")+this.formatCurrency(t))};Cart.prototype.updateTip=function(n){var t=typeof n!="undefined"?n:this.fromCents(this.getTip());this.$summaryTip.text(this.formatCurrency(t))};Cart.prototype.updateAmount=function(){$("#js-cart-amount").val(this.getTotal(!0))};Cart.prototype.updatePosData=function(){var n={cart:this.content,customAmount:this.fromCents(this.getCustomAmount()),discountPercentage:this.discount?parseFloat(this.discount):0,subTotal:this.fromCents(this.getTotalProducts()),discountAmount:this.fromCents(this.getDiscountAmount(this.totalAmount)),tip:this.tip?this.tip:0,total:this.getTotal(!0)};console.warn(n);$("#js-cart-posdata").val(JSON.stringify(n))};Cart.prototype.resetDiscount=function(){this.setDiscount(0);this.updateDiscount(0);$(".js-cart-discount").val("")};Cart.prototype.resetTip=function(){this.setTip(0);this.updateTip(0);$(".js-cart-tip").val("")};Cart.prototype.resetCustomAmount=function(){this.setCustomAmount(0);$(".js-cart-custom-amount").val("")};Cart.prototype.escape=function(n){return(""+n).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};Cart.prototype.template=function(n,t){var i=n.text(),r,u;for(r in t)u=new RegExp("{"+r+"}","mg"),i=i.replace(u,t[r]);return i};Cart.prototype.buildUI=function(){var t=$("#js-cart-extra").find("thead"),n=[];tableTemplate=this.template($("#template-cart-extra"),{discount:this.escape(this.fromCents(this.getDiscount())||""),customAmount:this.escape(this.fromCents(this.getCustomAmount())||"")});n.push($(tableTemplate));tableTemplate=this.template($("#template-cart-total"),{total:this.escape(this.formatCurrency(this.getTotal()))});n.push($(tableTemplate));t.append(n);$(".js-cart-discount").inputAmount(this,"discount");$(".js-cart-discount-remove").removeAmount(this,"discount");$(".js-cart-custom-amount").inputAmount(this,"customAmount");$(".js-cart-custom-amount-remove").removeAmount(this,"customAmount")};Cart.prototype.listItems=function(){var e=this.$list.find("tbody"),n=this,r=[],u="",f,t,i;if(this.content.length>0){for(f in this.content)t=this.content[f],i=t.image&&this.escape(t.image),i&&i.startsWith("~")&&(i=i.replace("~",window.location.pathname.substring(0,i.indexOf("/apps")))),u=this.template($("#template-cart-item"),{id:this.escape(t.id),image:i?this.template($("#template-cart-item-image"),{image:i}):"",title:this.escape(t.title),count:this.escape(t.count),inventory:this.escape(t.inventory<0?99999:t.inventory),price:this.escape(t.price.formatted||0)}),r.push($(u));e.html(r);r=[];$(".js-cart-item-count").off().on("input",function(){var h=this,i=$(this).closest("tr").data("id"),r=parseInt($(this).val()),e=!isNaN(r),o=parseInt($(this).data("prev")),f=Math.abs(r-o),s=r>o,u,t;if(e?$(this).data("prev",r):r=null,n.resetTip(),s)for(u=n.content.filter(function(n){return n.id===i}),t=0;t<f;t++)n.addItem({id:i,title:u.title,price:u.price,image:u.image});else if(!s)if(e)if(f>0)for(t=0;t<f;t++)n.decrementItem(i);else n.enableItem(i);else n.disableItem(i)});$(".js-cart-item-remove").off().on("click",function(t){t.preventDefault();n.resetTip();n.removeItemAll($(this).closest("tr").data("id"))});$(".js-cart-item-plus").off().on("click",function(t){if(t.preventDefault(),n.incrementItem($(this).closest("tr").data("id"))){var i=$(this).parents(".input-group").find(".js-cart-item-count"),r=parseInt(i.val()||i.data("prev"))+1;i.val(r);i.data("prev",r);n.resetTip()}});$(".js-cart-item-minus").off().on("click",function(t){t.preventDefault();var i=$(this).parents(".input-group").find(".js-cart-item-count"),u=$(this).closest("tr").data("id"),r=parseInt(i.val()||i.data("prev"))-1;n.resetTip();r===0?n.removeItemAll(u):(i.val(r),i.data("prev",r),n.decrementItem(u))})}};Cart.prototype.bindEmptyCart=function(){var n=this;this.emptyCartToggle();this.$destroy.click(function(t){t.preventDefault();n.destroy();n.emptyCartToggle()})};Cart.prototype.emptyCartToggle=function(){this.content.length>0||this.getCustomAmount()?(this.$destroy.show(),this.$confirm.removeAttr("disabled")):(this.$destroy.hide(),this.$confirm.attr("disabled","disabled"))};Cart.prototype.formatCurrency=function(n){var t="",u="",r="",i;return prefix="",postfix="",srvModel.currencyInfo.prefixed?(prefix=srvModel.currencyInfo.currencySymbol,srvModel.currencyInfo.symbolSpace&&(prefix=prefix+" ")):(postfix=srvModel.currencyInfo.currencySymbol,srvModel.currencyInfo.symbolSpace&&(postfix=" "+postfix)),u=srvModel.currencyInfo.thousandSeparator,r=srvModel.currencyInfo.decimalSeparator,t=n.toFixed(srvModel.currencyInfo.divisibility),i=t.split("."),t=(i[0]+".").replace(/(\d)(?=(\d{3})+\.)/g,"$1"+u),t=t.substr(0,t.length-1),i.length==2&&(t=t+r+i[1]),srvModel.currencyInfo.divisibility!==0&&(t[t.length-srvModel.currencyInfo.divisibility-1]=r),prefix+t+postfix};Cart.prototype.toNumber=function(n){return n*1||0};Cart.prototype.toCents=function(n){return n*Math.pow(10,srvModel.currencyInfo.divisibility)};Cart.prototype.fromCents=function(n){return n/Math.pow(10,srvModel.currencyInfo.divisibility)};Cart.prototype.percentage=function(n,t){return this.fromCents(n/100*t)};Cart.prototype.getStorageKey=function(n){return n+srvModel.appId+srvModel.currencyCode};Cart.prototype.saveLocalStorage=function(){localStorage.setItem(this.getStorageKey("cart"),JSON.stringify(this.content))};Cart.prototype.loadLocalStorage=function(){var i,n,t;for(this.content=$.parseJSON(localStorage.getItem(this.getStorageKey("cart")))||[],i=this,n=this.content.length-1;n>=0;n--){if(!this.content[n]){this.content.splice(n,1);continue}if(t=srvModel.items.find(function(t){return t.id===i.content[n].id}),t)t.inventory!=null&&t.inventory<=0?this.content.splice(n,1):t.inventory!=null&&t.inventory<this.content[n].count&&(this.content[n].count=t.inventory),this.content[n].inventory=t.inventory;else{this.content.splice(n,1);continue}this.items+=this.content[n].count;delete this.content[n].disabled}this.discount=localStorage.getItem(this.getStorageKey("cartDiscount"));this.customAmount=localStorage.getItem(this.getStorageKey("cartCustomAmount"));this.tip=localStorage.getItem(this.getStorageKey("cartTip"))};Cart.prototype.destroy=function(n){this.resetDiscount();this.resetTip();this.resetCustomAmount();n?(this.content=[],this.items=0):this.removeItemAll();localStorage.removeItem(this.getStorageKey("cart"))};$.fn.inputAmount=function(n,t){$(this).off().on("input",function(){var i=n.toNumber($(this).val());switch(t){case"customAmount":n.setCustomAmount(i);n.updateDiscount();n.updateSummaryProducts();n.updateTotal();n.resetTip();break;case"discount":n.setDiscount(i);n.updateDiscount();n.updateSummaryProducts();n.updateTotal();n.resetTip();break;case"tip":n.setTip(i);n.updateTip()}n.updateSummaryTotal();n.updateAmount();n.updatePosData();n.emptyCartToggle()})};$.fn.removeAmount=function(n,t){$(this).off().on("click",function(i){i.preventDefault();switch(t){case"customAmount":n.resetCustomAmount();n.updateSummaryProducts();break;case"discount":n.resetDiscount();n.updateSummaryProducts()}n.resetTip();n.updateTotal();n.updateSummaryTotal();n.emptyCartToggle()})};$.fn.addAnimate=function(n){$(this).find(".js-cart-added").length===0&&($(this).append('<div class="js-cart-added"><i class="fa fa-check fa-3x text-white align-middle"><\/i><\/div>'),$(this).find(".js-cart-added").fadeIn(200,function(){var t=this;setTimeout(function(){$(t).fadeOut(100,function(){$(this).remove();n&&n()})},200)}))};jQuery.expr[":"].icontains=function(n,t,i){var r=removeAccents(jQuery(n).text().toLowerCase());return r.indexOf(removeAccents(i[3].toLowerCase()))>=0};$(document).ready(function(){var n=new Cart;$(".js-add-cart").click(function(t){t.preventDefault();var i=$(t.target),r=this;index=i.closest(".card").data("index");item=srvModel.items[index];items=n.items;$(this).hasClass("disabled")||($(this).addClass("disabled"),$(this).addAnimate(function(){$(r).removeClass("disabled")}),n.addItem({id:item.id,title:item.title,price:item.price,image:typeof item.image!="undefined"?item.image:null,inventory:item.inventory}),n.listItems())});$("#js-cart-pay").click(function(){n.destroy(!0)});$("#js-cart-pay-form").on("submit",function(){var n=$("#js-cart-pay");n&&(n.attr("disabled",!0),n.prepend('<div class="spinner-grow spinner-grow-sm align-baseline" role="status">    <span class="visually-hidden">Loading...<\/span><\/div>'))});$(".js-cart").on("click",function(){$("#sidebar, #content").toggleClass("active");$(".collapse.in").toggleClass("in");$("a[aria-expanded=true]").attr("aria-expanded","false")});$(".js-search").keyup(function(){var n=$(this).val(),t;$("#js-pos-list").find(".card-wrapper").show();n.length>1?(t=$("#js-pos-list").find(".card-title:not(:icontains('"+$.escapeSelector(n)+"'))"),t.parents(".card-wrapper").hide(),$(".js-search-reset").show()):n.length===0&&$(".js-search-reset").hide()});$(".js-search-reset").click(function(n){n.preventDefault();$(".js-search").val("");$(".js-search").trigger("keyup");$(this).hide()});$("#js-cart-summary").find("tbody").prepend(n.template($("#template-cart-tip"),{tip:n.fromCents(n.getTip())||""}));$("#cartModal").one("show.bs.modal",function(){n.updateDiscount();n.updateTip();n.updateSummaryProducts();n.updateSummaryTotal();$(".js-cart-tip").inputAmount(n,"tip");$(".js-cart-tip-remove").removeAmount(n,"tip");$(".js-cart-tip-btn").click(function(t){t.preventDefault();var i=$(".js-cart-tip"),r=n.percentage(n.getTotalProducts(),n.getDiscount()),u=n.getTotalProducts()-r,f=parseInt($(this).data("tip")),e=n.percentage(u,f).toFixed(srvModel.currencyInfo.divisibility);i.val(e);i.trigger("input")})})});